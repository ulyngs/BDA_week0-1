---
title: "Big Data Analytics Week 1"
author: "Ulrik Lyngs (based on Bertie Vidgen's materials)"
date: "2020-02-17"
output: html_document
---
 
# BDA Week 1 notes
This week we look at how to quantify the spread of a distribution using the Gini coefficient and shannon entropy. We will also plot a histogram and calculate the mode.

Set up the R workspace and load the required packages/data.

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
options(scipen = 10) #makes the output more readable by increasing the number of values before scientific notation is used.

fun_check_packages <- function(x){
  for (i in seq(1,length(x))){
    if (!x[i] %in% installed.packages()){
    install.packages(x[i])}
    library(x[i],character.only=TRUE)}
}
packs = c('ineq','ggplot2', 'entropy', 'cowplot', 'dplyr')
fun_check_packages(packs)

```

### Data
In the code below, we calculate the gini coefficient and then plot the lorenz curve for the 'mtcars' dataset. This comes with every installation of R. You can apply the code to the data you've collected from Wikipedia.

We are going to look at the 'disp' variable in the dataset 'mtcars', which has data for 32 cars from 1973-74 on various variables and is built in to R. 'disp' stands for displacement and something about how the cars' engine is structured. 

```{r}
mtcars
```


### Histogram
First, make a histogram to show the distribution of the variable:

```{r hist, echo = F}
ggplot(mtcars,
       aes(disp)) +
  geom_histogram(bins = 10)

```

### Mode
Second, calculate the mode of the variable, and how many values are equal to it.
Unfortunately, R does not have an in-built mode function, so we have to create one:

```{r mode, echo = F}
getMode <- function(x, na.rm = FALSE) {
  if(na.rm){
    x = x[!is.na(x)]
  }
  ux <- unique(x)
  return(ux[which.max(tabulate(match(x, ux)))])
} # from https://stackoverflow.com/questions/2547402/is-there-a-built-in-function-for-finding-the-mode

getMode(mtcars$disp) #mode

# How many of the values equal the mode?
numMode <- length(mtcars$disp[mtcars$disp == getMode(mtcars$disp)])

print(numMode)

```

Here's an alternative approach that might be more transparent.
The '%>%' operator is from the `dplyr` package and simply means 'then do this'.

```{r}
# take the mtcars dataset, then group it by the amount of 'disp', then count how many times they occur 
mtcars %>% 
  group_by(disp) %>% 
  count() %>% 
  arrange(desc(n))

```

It is clear that the most frequently value is 275.8, which occurs 3 times.


### Gini coefficient
Third, calculate the gini coefficient and plot the Lorenz curve.

The Gini coefficient is a measure of statistical dispersion. It can be applied to any variable to see how it is distributed - most famously, it has been used to measure income distribution. A score of '1' indicates perfect inequality. In the case of income, this means that one person has all the income and no-one else has any. A score of '0' indicates perfect equality. In the case of income, this means that every person has the exact same income.

The Gini coefficient is the area between the line of 'perfect equality' (where the gini coefficient is 0; the distribution of the variable is uniform, i.e. totally equal) and the 'lorenz curve' (which is the actual distribution of values across the population).

Sal Khan (the Khan Academy founder) has a crystal clear explanation of the Gini coefficient and the Lorenz curve here: https://www.youtube.com/watch?v=y8y-gaNbe4U

We can calculate the gini coefficient using the `ineq` function from the `ineq` package, and plot the Lorenz curve with base R:

```{r gini, echo = F}
ineq::ineq(mtcars$disp,
           type='Gini') #calculate the gini coefficient for the variable disp

```

The `Lc` function from the `ineq` package calculates values for the Lorenz curve. 
We can use this to plot the Lorenz curve with base R like this:
```{r}
plot(ineq::Lc(mtcars$disp),
     col = 'red',
     lwd = 2)
```


Or with ggplot like this:
```{r}
lorenz_data <- ineq::Lc(mtcars$disp)

# ggplot needs your data to be a data frame object
lorenz_data_frame <- data.frame(p = lorenz_data$p, L = lorenz_data$L)

ggplot(lorenz_data_frame, aes(p, L)) +
  geom_segment(aes(x = 0,
                   y = 0,
                   xend = 1,
                   yend = 1)) +
  geom_line(color = 'red') +
  labs(x = "% population", y = "% variable")
# based on: https://stackoverflow.com/questions/22679493/how-to-plot-a-nice-lorenz-curve-for-factors-in-r-ggplot

```


If you find the Gini coefficient particularly interesting, then have a look at some additional material here: https://www.r-bloggers.com/sampling-distribution-of-gini-coefficient/


### Shannon entropy
Entropy is a measure of disorder within a distribution; higher entropy means that a system is more disordered and therefore harder to predict. If you want a refresher, with a nice worked through example, I found a great Youtube video here - https://www.youtube.com/watch?v=ErfnhcEV1O8&list=LLpnMwTVTiriukuWO3AenRSA&index=2&t=333s 
Only the first few minutes are relevant for understanding Shannon entropy (they guy then goes onto discuss cross-entropy) but it really is worth a look.

We can use the `entropy` package to calculate entropy in observed data.

```{r shannon-entropy, echo = F}
?entropy.empirical # info on params you can adjust

# take a look at the values in the 'horsepower' variable in the mtcars dataset
mtcars$hp

# calculate actual entropy
ent_calc <- entropy::entropy.empirical(mtcars$hp, unit="log2")

# calculate max entropy
ent_max <- log2(sum(mtcars$hp))

# calculate normalized entropy
ent_calc / ent_max

# See here for some discussions about implementing entropy: https://math.stackexchange.com/questions/395121/how-entropy-scales-with-sample-size


```


### Example with wikipedia data
Here is an example, using wikipedia data that came from this query:

USE simplewiki_p;
SELECT * FROM page LIMIT 100;

Let's read in the data
```{r}
page_query <- read.csv("2020-02-26_page_query.csv")
```


Now, let's draw a histogram:

```{r}
ggplot(page_query, aes(page_len)) +
  geom_histogram()
```

Now let's draw the lorenz curve:

```{r}
lorenz_data <- ineq::Lc(page_query$page_len)

# ggplot needs your data to be a data frame object
lorenz_data_frame <- data.frame(p = lorenz_data$p, L = lorenz_data$L)

ggplot(lorenz_data_frame, aes(p, L)) +
  geom_segment(aes(x = 0,
                   y = 0,
                   xend = 1,
                   yend = 1)) +
  geom_line(color = 'red') +
  labs(x = "% population", y = "% variable")
# based on: https://stackoverflow.com/questions/22679493/how-to-plot-a-nice-lorenz-curve-for-factors-in-r-ggplot

```



*** END ***




